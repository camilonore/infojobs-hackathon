---
import type { OfferResponse } from '../types/infojobsApi'
import { token } from '../utils'

const url = 'https://api.infojobs.net/api/9/offer?facets=true&maxResults=1'
const response = await fetch(url, {
  headers: {
    Authorization: `Basic ${token}`
  }
})
const offers: OfferResponse = await response.json()
---

<div class='jobs-container'>
  <p class='section-title'>Los Empleos Más Demandados</p>
  <div class='categories-container'>
    {
      offers.facets.map((facet) => {
        if (facet.name == 'Categoría') {
          const categories = facet.values.slice(0, 8)
          return categories.map((category, idx) => {
            return (
              <>
                <div class={`category-card place-${idx}`}>
                  <p class='title'>{category.value}</p>
                  <p class='count'>{category.count} Empleos</p>
                  <img src={`image${idx}.webp`} alt='' />
                </div>
              </>
            )
          })
        }
      })
    }
  </div>
</div>

<style>
  .jobs-container {
    max-width: 90%;
    margin: auto;
    padding: 50px 0;
    height: 100%;
  }
  .section-title {
    color: #fff;
    font-size: var(--text-lg);
    font-weight: 500;
  }
  .categories-container {
    width: 80%;
    height: 100%;
    display: grid;
    margin: 40px auto;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(9, 1fr);
    gap: 10px;
  }
  .category-card {
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    text-transform: capitalize;
    width: 100%;
    border-radius: var(--rounded);
    padding: 20px;
  }
  .category-card > img {
    position: absolute;
    top: 0;
    height: 100%;
    width: 100%;
    object-fit: cover;
    z-index: 0;
    filter: brightness(0.8);
  }
  .title {
    z-index: 1;
    color: #fff;
    font-size: var(--text-md);
    font-weight: bold;
  }
  .count {
    z-index: 1;
    padding: 5px 10px;
    font-size: var(--text-sm);
    border-radius: var(--rounded);
    width: fit-content;
    color: #fff;
    background-color: #23536e;
  }
  .place-0 {
    grid-column: 1;
    grid-row: 2/8;
  }
  .place-1 {
    grid-column: 2;
    grid-row: 1/5;
  }
  .place-2 {
    grid-column: 3;
    grid-row: 2/4;
  }
  .place-3 {
    grid-column: 4;
    grid-row: 1/5;
  }
  .place-4 {
    grid-column: 5;
    grid-row: 2/8;
  }
  .place-5 {
    grid-column: 2;
    grid-row: 5/9;
  }
  .place-6 {
    grid-column: 3;
    grid-row: 4/8;
  }
  .place-7 {
    grid-column: 4;
    grid-row: 5/9;
  }
</style>
